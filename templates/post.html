{% extends "base.html" %}

{% block title %}WIT Forum{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-sm navbar-light bg-light">
    <a class=" navbar-brand" href="/"><span class="text-primary">WIT</span>Boards</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    Zoom
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    {% for zoom in zoom_list %}
                    {% if zoom.User == user %}
                    <a class="dropdown-item" href="{{ zoom.zoom_url }}">{{ zoom.zoom_title }}</a>
                    {% endif %}
                    {% endfor %}
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="/forms/zoom/add">Add Zoom link</a>
                </div>
            </li>
            {% endif %}
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    FAQs
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a target="_blank" class="dropdown-item"
                        href="https://cheatography.com/lucbpz/cheat-sheets/the-ultimate-markdown/">Markdown Help</a>
                </div>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            {% if user.is_authenticated %}
            <li>
                <span class="nav-link disabled text-primary">Hi {{ user.first_name }}!</span>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/user/{{ user.id }}">Profile</a>
            </li>
            <li class="nav-item">
                <a href="{% url 'logout' %}" class="btn btn-primary">Logout</a>
            </li>
            {% else %}
            <li class="nav-item">
                <a href="{% url 'login' %}" class="nav-link">Login</a>
            </li>
            <li class="nav-item">
                <a href="{% url 'signup' %}" class="nav-link">Sign up</a>
            </li>
            {% endif %}
        </ul>
    </div>
</nav>
{% endblock %}

{% block content %}
<!-- TODO: Page layout -->

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="/#{{ category.Board.pk }}">{{ post.Category.Board.board_title }}</a></li>
        <li class="breadcrumb-item"><a href="/category/{{ post.Category.pk }}">{{ post.Category.category_title }}</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">{{ post.post_title }}</li>
    </ol>
</nav>


<h3 class="card-title">{{ post.post_title }}</h3>

{% load markdown_extras %}

<div class="card mb-4">
    <div class="row no-gutters">
        <div class="col-2 border-right">
            <div class="m-3 text-center">
                <img src="https://picsum.photos/200" class="card-img" alt="">
                <p class="pt-1 text-muted">
                    {{ post.User.first_name }} {{ post.User.last_name }}<br />
                    <small class="text-muted">{{ post.User.username }}</small><br />
                    <small class="text-muted">{{ post.User.user_department }}</small>
                </p>
            </div>
        </div>
        <div class="col">
            <div class="card-body">

                <p class="card-text">{{ post.post_text | markdown | safe }}</p>

                {% load tz %}
                {% timezone "America/New_York" %}
                <p class="card-text align-self-end"><small class="text-muted">{{ post.post_time }}</small></p>
                {% endtimezone %}
            </div>
            {% if post.User.user_signature %}
            <div class="card-body border-top align-self-end">
                <p class="card-text text-muted text-center">{{ post.User.user_signature | markdown | safe }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% for comment in comments %}
<div class="card mb-4">
    <div class="row no-gutters">
        <div class="col-2 border-right">
            <div class="m-3 text-center">
                <img src="https://picsum.photos/200/" class="card-img" alt="">
                <p class="pt-1 text-muted">
                    {{ comment.User.first_name }} {{ comment.User.last_name }}<br />
                    <small class="text-muted">{{ comment.User.username }}</small><br />
                    <small class="text-muted">{{ comment.User.user_department }}</small>
                </p>
            </div>
        </div>
        <div class="col">
            <div class="card-body">
                <p class="card-text">{{ comment.comment_text | markdown | safe }}</p>

                {% load tz %}
                {% timezone "America/New_York" %}
                <p class="card-text align-self-end"><small class="text-muted">{{ comment.comment_time }}</small></p>
                {% endtimezone%}
            </div>
            {% if comment.User.user_signature %}
            <div class="card-body border-top align-self-end">
                <p class="card-text text-muted text-center">{{ comment.User.user_signature | markdown | safe }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endfor %}

<form action="/forms/comment/add/{{ post.pk }}" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    {% if user.is_authenticated %}
    <button class="btn btn-primary" type="submit">Reply</button>
    <!-- Button trigger modal -->
    <button type="button" class="btn" data-toggle="modal" data-target="#exampleModal">
        <span class="material-icons">
            help_outline
        </span>
    </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Markdown Cheat Sheet</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img src="https://laurelscode.files.wordpress.com/2017/06/markdown.png?w=470&h=382" alt="">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <button class="btn btn-primary disabled">Reply</button>
    <p>You must sign in to reply.</p>
    {% endif %}
</form>
{% endblock %}